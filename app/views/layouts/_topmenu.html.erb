<div class="topmenu">
  <% if current_user %>
    <li><%= link_to image_tag('menu/logout.png'),logout_path,method: :delete  %></li>
      <li id="mailboxicon">
        <%= link_to image_tag('menu/mailbox.png', :id => 'mailbox'),messages_path %>
        <%= link_to image_tag('menu/mailboxhover.png', :id => 'mailboxhover'),messages_path %>
      </li>
      <li id="notification">
        <div id ='notificationLink'>
          <%= image_tag('menu/notify.png') %>
        </div>
        <div id="notificationContainer">
          <div id="notificationTitle">通知</div>
          <div id="notificationsBody">
            <% mynotice.each do |n|  %>
              <% if n.types == 1 || n.types == 3 %>
                <div class ='notifications notifypost-show' data-id="<%= n.sender_id %>"><%=  n.body %></div>
              <% else %>
                <%= link_to n.body , user_path(n.sender_id),:class => 'notifications' %>
              <% end %>
            <% end %>
          </div>
          <div id="notificationFooter"><%= link_to '全部通知',notice_path %></div>
        </div>
      </li>
  <% else %>
    <li><%= link_to image_tag('menu/login.png'),login_path %></li>
  <% end %>
</div>

<div class="modal fade" id="notifypostmodal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
    </div>
  </div>
</div>

<script>
  $('#mailboxicon')
  .mouseover(function(){
    $('#mailbox').hide();
    $('#mailboxhover').show();
  })
  .mouseout(function() {
    $('#mailbox').show();
    $('#mailboxhover').hide();
  });


  $(document).ready(function() {
    $("#notificationLink").click(function() {
      event.preventDefault();
      if ($('#notificationContainer').css('display') == 'none'){
        $("#notificationContainer").fadeIn();
      }
      else{
        $("#notificationContainer").fadeOut();
      }
    });
    /* ajax show */
    $('.notifypost-show').on('click',function(){
      var ajaxurl = '/posts/' + this.getAttribute("data-id");
      $.ajax({
        url:ajaxurl,
        type: 'GET',
        success: function(response) {
          $('#notifypostmodal .modal-content').prepend(response);
          $('#notifypostmodal').data('bs.modal').handleUpdate();
        }
      });
    });
    $('#notifypostmodal').on('hidden.bs.modal', function () {
      $('#notifypostmodal .modal-content').empty();
    });
  });
</script>
